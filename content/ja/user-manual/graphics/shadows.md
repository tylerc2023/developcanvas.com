---
title: 影
template: usermanual-page.tmpl.html
position: 3
---

影はゲームにリアリティを与える重要な要素です。

![Characters with shadow casting][1]

PlayCanvasにはシャドウマッピングという影を生成するアルゴリズムが実装されています。プラットフォーム間の互換性があり、モバイル端末とデスクトップ両方で動作することが保証されています。さらに、影の機能は無料で誰でも使うことができます。ゲームの見栄えをよくするためにProアカウントを作る必要はありません。

## 影をつける

<img src="/images/user-manual/components/component-light-directional.jpg" style="width: 300px; float: right; padding: 20px; padding-top: 0px;"/>

影を付ける方法は簡単です。まず、シーンの中のどの光源が影を生成するかを決めます。

エンティティの階層から対象の光源を選択し、'Cast Shadows'オプションをチェックします:

<img src="/images/user-manual/components/component-model.jpg" style="width: 300px; float: right; padding: 20px; padding-top: 0px;"/>

次に、シーンの中のどの物体が影を投影するか、そしてどの物体に影が投影されるかを指定します。デフォルトではすべての物体が影を投影しないが、投影される設定になっています。エンティティから影を投影するには、パックエクスプローラからエンティティを選択し、モデルコンポーネントを選択して'Cast Shadows'オプションを選択します:

このようにすれば、エディタの3Dビューに影が表示されるはずです。

## 影のチューニング

PlayCanvasで使われているシャドウマッピングは有限の解像度しか持ちませんが、パラメータを調整することで見た目を良くすることができます。

### 投影距離のチューニング

投影距離はビューポイントからどれだけ離れると影が描画されなくなるかを決めるパラメータです。この値が小さければ小さいほど、影は鮮明になります。しかしこの値を小さくしすぎると、シーン内で視点を動かした時に突然影が現れるかもしれません。プレイヤーがどれだけ遠くを見るかという要素と、影がおおむねきれいに見えるバランスを考えて値を決めてください。

投影距離は、Scene Settingパネルから設定することができます。

### 影野解像度

すべての光源はシャドウマップを使用して影を投影します。シャドウマップは256x256, 512x512, 1024x1024, 2048x2048のいずれかの解像度を設定できます。この値はlightコンポーネントのインタフェースにも設定できます。この解像度が高ければ高いほど、影は鮮明になります。ただし、高い解像度の影はレンダリングに時間がかかるため、パフォーマンスの影のクオリティのバランスを考えて設定してください。

### 影のバイアス

シャドウマッピングは非常に目立つ不自然な描画をする場合があります。もし影の帯や斑点状のノイズを見つけたら、影のバイアスを調整することで解決する場合があります。

### 法線方向のオフセットバイアス

'影の斑点'と呼ばれる不自然な表示は目立つ問題ですが、シャドウバイアスを調整して対処することができます。ただし、この調整をすると’ピーターパン現象'が発生し、影によって多少物体が浮いているように見えてしまうことがあります。

法線方向のオフセットバイアスによってこの問題に対処することができます。深さ方向のバイアスに加えて、シャドウマップの参照時に使われるUVマッピングをわずかに調整することで、影の斑点とピーターパン現象の二つを同時に避けることができます。フラグメントの位置を法線方向にずらす"法線方向のオフセット"はシャドウバイアスだけで問題に対処するよりも、大幅に見た目を改善します。

[1]: /images/user-manual/graphics/shadows/doom3_shadows.jpg

