---
title: 最適化のガイドライン
template: usermanual-page.tmpl.html
position: 1
---

PlayCanvasアプリで最適なパフォーマンスを得るためのヒントをいくつか紹介します。

## JavaScript

*JavaScriptオブジェクト(特にベクター、行列、四元数)を割り当てるために'new'を呼び出すと、動的な割り当てを表すので負荷がかかる場合があります。したがって、可能な場合はスクリプトのinitialize関数で事前にオブジェクトを割り当ててupdate関数でそれらを再利用するべきです。また、定期的なフリーズを引き起こす可能性があるGarbage Collection にもつながります。

## 画像

*テクスチャ異方性の値が大きくなると、視覚的な改善は得られますがパフォーマンスは低下します。

パフォーマンスとビジュアルのバランスをとるようにしてください。
*単一の画像に複数のテクスチャをパックするように心がけてください。例えば、拡散マップのアルフ

ァチャンネルに不透明度マップのグレースケールを保存することができます。または鏡面マップのアル

ファチャンネルにグレースケール光沢マップを保存することができます。これにより、VRAMの使用量が

減少します。
* シーン内のダイナミックライトの数に注意してください。最小限にするべきです。
* 動的ライトのシャドウキャスティングを有効にすると負荷が掛かります。特にポイントライトの影は

負荷が高いです。影を落とす各ポイントライトに対して、シーンを6回シャドウマップにレンダリング

する必要があります。
* PlayCanvasでは、メッシュインスタンスは、ドローコールです(個々のグラフィカルプリミティブを

描画するコマンド)。各ドローコールでWebGLに派遣する際、CPU上に負担が掛かります。したがって、

ドローコールの数を低く保つことをお勧めします（モバイルでは特に）。モデルアセットを選択し、イ

ンスペクタでそれを表示させることで、特定のモデルのドローコールのリストを確認することができま

す。ローエンドのモバイル端末の場合、ドローコールの目安は100-200です。一方、ハイエンドのデス

クトップマシンの場合、毎フレームで何千ものドローコールを処理しても60fpsを維持することができ

ます。
* プロジェクトの設定で'Use Device Pixel Ratio'を有効にする際は注意が必要です。PlayCanvasアプ

リはデバイスのネイティブ解像度を利用してピクセレーションを減少させますが、より多くのピクセル

が充填される場合があり、フレームレートの大幅な低下が発生する可能性があります。
* シーン内のブレンドされたメッシュインスタンスの数を最小限にしてください。ブレンドされたメッ

シュはすべての不透明なメッシュインスタンスが派遣されるまで延期され、カメラ深度に対して後ろか

ら前の順序に提出されます。結果、ピクセルは何度も充填され、ブレンドされたメッシュは素材別にソ

ートできないので、レンダリング状態の変更回数が増えます。
* アプリによって生成されるシェーダの数を最小限に保つようにしてください。シェーダはコンパイル

され、要求に応じてリンクする必要があり、この操作には負荷が掛かるためアプリの起動の遅延やフレ

ームレートのグリッチを引き起こします。素材Aには発光マップがあり、素材Bには無い場合、二つのシ

ェーダが生成されます。素材Bに黒い発光マップを設定した場合、素材は同じシェーダを共有すること

ができます。シーン内の素材の数を減らすと、生成されたシェーダの数も減ります。
* ポストエフェクトには負荷がかかるので、有効にする際は注意が必要です。ピクセルフィルは負担が

かかります。
* 可視性の計算と比較してパフォーマンスに負担が掛からない場合のみ、カメラコンポーネントの錐台カリングを有効にします。すべてのメッシュのインスタンスが常に表示されるシーンをレンダリングしている場合は、このオプションを無効にするべきです。
* 素材のバックフェースカリングを有効にするより、無効にするほうが負荷がかかります。基本的に、バックフェースカリングはGPUが埋めるピクセルの数を減らします。これは、新しく作成された素材のデフォルト設定です。

## 物理

*衝突メッシュはレンダリング可能なメッシュと同じ精密レベルである必要はありません。コリジョンの解像度メッシュを低く設定することをお勧めします。
*シーンの動的リジッドボディの数は最小限にしてください（特にモバイルで）。

